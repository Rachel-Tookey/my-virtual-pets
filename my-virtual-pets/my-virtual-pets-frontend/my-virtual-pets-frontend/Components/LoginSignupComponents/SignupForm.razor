@using my_virtual_pets_class_library.DTO

<EditForm FormName="Login" Model="@userDetails" OnInvalidSubmit="HandleInvalidSubmit" OnValidSubmit="HandleValidSubmit">
    <h3>Sign-up Form</h3>
    <h6>@Success</h6>
    <DataAnnotationsValidator/>

    <div class="form-group">
        <label for="InputFirstName">Username:</label>
        <InputText id="InputFirstName" class="form-control" @bind-Value="@userDetails.FirstName"/>
        <ValidationMessage For="@(() => userDetails.FirstName)"/>
    </div>

    <div class="form-group">
        <label for="InputLastName">Username:</label>
        <InputText id="InputLastName" class="form-control" @bind-Value="@userDetails.LastName"/>
        <ValidationMessage For="@(() => userDetails.LastName)"/>
    </div>

    
    <div class="form-group">
        <label for="InputEmail">Username:</label>
        <InputText id="InputEmail" class="form-control" @bind-Value="@userDetails.Email"/>
        <ValidationMessage For="@(() => userDetails.Email)"/>
    </div>

    <div class="form-group">
        <label for="InputUsername">Username:</label>
        <InputText id="InputUsername" class="form-control" @bind-Value="@userDetails.Username"/>
        <ValidationMessage For="@(() => userDetails.Username)"/>
    </div>
    

    <div class="form-group">
            <label for="InputPassword">Password:</label>
            <InputText id="InputPassword" class="form-control" @bind-Value="@userDetails.Password"/>
            <ValidationMessage For="@(() => userDetails.Password)"/>
            </div>

    <p>By submitting this form you are agreeing to our service and privacy policy</p>
    <button id="registerbutton" class="btn btn-light" type="submit">Enter the doghouse</button>

</EditForm>


@code {
    
    public NewUserDTO userDetails { get; set; } 
    
    public string Success { get; set; }
    
    protected override void OnInitialized()
    {
        userDetails = new NewUserDTO();
    }

    public void HandleInvalidSubmit()
    {
        Success = "Something has gone wrong"; 
    }

    public void HandleValidSubmit()
    {
        Success = "Submitted!";
        userDetails.GDPRPermissions = true; 
        var webclient = new BackendClient<NewUserDTO>("api/user/register");
        webclient.PostRequest(userDetails);
        userDetails = new NewUserDTO();
    }
    
}